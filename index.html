<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-512.svg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Ulysses</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- Preload CodeMirror modules so they download in parallel with app.js -->
  <link rel="modulepreload" href="https://esm.sh/@codemirror/view@6">
  <link rel="modulepreload" href="https://esm.sh/@codemirror/state@6">
  <link rel="modulepreload" href="https://esm.sh/@codemirror/commands@6">
  <link rel="modulepreload" href="https://esm.sh/@codemirror/lang-markdown@6">
  <link rel="modulepreload" href="https://esm.sh/@codemirror/language@6">
  <link rel="modulepreload" href="https://esm.sh/@codemirror/autocomplete@6">
  <link rel="modulepreload" href="https://esm.sh/@codemirror/search@6">
</head>
<body>
  <!-- Loading screen â€” visible instantly, hidden when JS initializes -->
  <div id="app-loading" style="position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:var(--bg-primary,#1a1a2e);transition:opacity .3s">
    <div style="text-align:center;color:var(--text-secondary,#888)">
      <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity:.5;margin-bottom:12px"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
      <div style="font:14px -apple-system,sans-serif">Loading...</div>
    </div>
  </div>

  <div id="app" tabindex="-1">
    <!-- Library Panel -->
    <div id="library-panel">
      <div class="panel-header">
        <h2>Library</h2>
        <div class="panel-header-actions"><button class="btn-icon logout-header-btn" id="header-logout-btn" title="Sign Out"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/></svg></button>
          <button class="btn btn-icon" id="new-group-btn" title="New Group">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
              <line x1="12" y1="11" x2="12" y2="17"/>
              <line x1="9" y1="14" x2="15" y2="14"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="library-scroll">
        <div class="library-tree" id="library-tree"></div>
        <div class="tags-section" id="tags-section">
          <h3>Keywords</h3>
          <div class="tags-list" id="tags-list"></div>
          <button class="btn" id="add-tag-btn" style="font-size: 11px; margin-top: 4px; width: 100%;">+ Add Keyword</button>
        </div>
      </div>
    </div>

    <!-- Sheets Panel -->
    <div id="sheets-panel">
      <div class="panel-header">
        <button class="mobile-back" id="mobile-back-library"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button><h2 id="sheets-panel-title">Inbox</h2>
        <div class="panel-header-actions">
          <button class="btn btn-icon" id="new-sheet-btn" title="New Sheet (Cmd+N)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="12" y1="18" x2="12" y2="12"/>
              <line x1="9" y1="15" x2="15" y2="15"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="sort-sheets-btn" title="Sort">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="4" y1="6" x2="20" y2="6"/>
              <line x1="4" y1="12" x2="14" y2="12"/>
              <line x1="4" y1="18" x2="8" y2="18"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="search-bar" id="sheet-search-bar">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text" id="sheet-filter" placeholder="Filter sheets...">
        <button class="search-tag-toggle" id="tag-filter-toggle" title="Filter by tag">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/>
            <line x1="7" y1="7" x2="7.01" y2="7"/>
          </svg>
        </button>
      </div>
      <div class="tag-filter-bar" id="tag-filter-bar" style="display:none;"></div>
      <div class="sheet-list" id="sheet-list"></div>
    </div>

    <!-- Editor Panel -->
    <div id="editor-panel">
      <div class="editor-toolbar">
        <div class="editor-toolbar-left"><button class="mobile-back" id="mobile-back-sheets"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
          <button class="btn btn-icon" id="toggle-library" title="Toggle Library (Cmd+1)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="7" height="18" rx="1"/>
              <rect x="14" y="3" width="7" height="18" rx="1"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="toggle-sheets" title="Toggle Sheets (Cmd+2)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
          </button>
        </div>
        <div class="editor-toolbar-center"></div>
        <div class="editor-toolbar-right">
          <button class="btn btn-icon" id="outline-btn" title="Outline">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="8" y1="6" x2="21" y2="6"/>
              <line x1="8" y1="12" x2="21" y2="12"/>
              <line x1="8" y1="18" x2="21" y2="18"/>
              <line x1="3" y1="6" x2="3.01" y2="6"/>
              <line x1="3" y1="12" x2="3.01" y2="12"/>
              <line x1="3" y1="18" x2="3.01" y2="18"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="attachments-btn" title="Attachments & Notes">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="goal-btn" title="Writing Goal">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <circle cx="12" cy="12" r="6"/>
              <circle cx="12" cy="12" r="2"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="focus-mode-btn" title="Focus Mode">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v4"/>
              <path d="M12 19v4"/>
              <path d="M1 12h4"/>
              <path d="M19 12h4"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="typewriter-btn" title="Typewriter Mode">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="4" width="20" height="16" rx="2"/>
              <line x1="6" y1="8" x2="18" y2="8"/>
              <line x1="6" y1="12" x2="18" y2="12"/>
              <line x1="10" y1="16" x2="14" y2="16"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="split-btn" title="Split View">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <line x1="12" y1="3" x2="12" y2="21"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="search-btn" title="Search (Cmd+Shift+F)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"/>
              <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="export-btn" title="Export">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="btn btn-icon" id="theme-btn" title="Toggle Theme">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="editor-container" id="editor-container">
        <div class="stats-float" id="stats-float">
          <div class="stats-float-trigger">
            <svg class="stats-badge-ring" viewBox="0 0 40 40">
              <circle class="stats-badge-track" cx="20" cy="20" r="17" />
              <circle class="stats-badge-progress" id="stats-badge-ring" cx="20" cy="20" r="17" />
            </svg>
            <div class="stats-float-badge" id="stats-badge">0</div>
          </div>
          <div class="stats-float-popover" id="stats-popover">
            <div class="stats-ring-section">
              <svg class="stats-ring" viewBox="0 0 120 120">
                <circle class="stats-ring-track" cx="60" cy="60" r="52" />
                <circle class="stats-ring-progress" id="sp-ring" cx="60" cy="60" r="52" />
              </svg>
              <div class="stats-ring-label">
                <span class="stats-ring-subtitle" id="sp-subtitle"></span>
                <span class="stats-ring-count" id="sp-words">0</span>
                <span class="stats-ring-unit">words</span>
              </div>
            </div>
            <div class="stats-goal-label" id="sp-goal-label"></div>
            <div class="stats-popover-divider"></div>
            <div class="stats-detail-grid">
              <div class="stats-detail-item">
                <span class="stats-detail-value" id="sp-chars">0</span>
                <span class="stats-detail-label">characters</span>
              </div>
              <div class="stats-detail-item">
                <span class="stats-detail-value" id="sp-sentences">0</span>
                <span class="stats-detail-label">sentences</span>
              </div>
              <div class="stats-detail-item">
                <span class="stats-detail-value" id="sp-paragraphs">0</span>
                <span class="stats-detail-label">paragraphs</span>
              </div>
              <div class="stats-detail-item">
                <span class="stats-detail-value" id="sp-reading">0 min</span>
                <span class="stats-detail-label">reading time</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Markup Bar: Ulysses-style formatting toolbar -->
      <div class="markup-bar" id="markup-bar">
        <div class="markup-bar-inner"></div>
        <div class="markup-stats" id="markup-stats">
          <span id="markup-stats-label">0 words</span>
          <div class="markup-stats-popover" id="markup-stats-popover">
            <div class="stats-popover-row stats-popover-main">
              <span class="stats-popover-value" id="msp-words">0</span>
              <span class="stats-popover-label">words</span>
            </div>
            <div class="stats-popover-divider"></div>
            <div class="stats-popover-row">
              <span class="stats-popover-label">Characters</span>
              <span class="stats-popover-value" id="msp-chars">0</span>
            </div>
            <div class="stats-popover-row">
              <span class="stats-popover-label">Characters (no spaces)</span>
              <span class="stats-popover-value" id="msp-chars-ns">0</span>
            </div>
            <div class="stats-popover-row">
              <span class="stats-popover-label">Sentences</span>
              <span class="stats-popover-value" id="msp-sentences">0</span>
            </div>
            <div class="stats-popover-row">
              <span class="stats-popover-label">Paragraphs</span>
              <span class="stats-popover-value" id="msp-paragraphs">0</span>
            </div>
            <div class="stats-popover-row">
              <span class="stats-popover-label">Reading time</span>
              <span class="stats-popover-value" id="msp-reading">0 min</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
